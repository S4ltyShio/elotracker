<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Ranked Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #010a13; /* Deep blue-black */
            background-image: radial-gradient(circle at top center, rgba(12, 74, 110, 0.5), #010a13 60%);
            background-repeat: no-repeat;
        }
        .card {
            background-color: #0a1428;
            border: 1px solid #1e2d4b;
        }
        .brand-gold { color: #c8aa6e; }
        .brand-blue { color: #55a3cf; }
        .brand-green { color: #2ecc71; }
        .brand-red { color: #e74c3c; }
        .loader {
            border: 4px solid #1e2d4b;
            border-top: 4px solid #55a3cf;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="tracker-card" class="max-w-sm w-full mx-auto card rounded-xl shadow-2xl overflow-hidden transform hover:scale-101 transition-transform duration-300 hidden">
        <!-- Header Section -->
        <div class="p-6 border-b border-gray-700/50 text-center">
            <h1 class="text-3xl font-extrabold text-white tracking-wider" id="summoner-name"></h1>
            <p class="text-sm font-semibold brand-blue uppercase" id="server"></p>
        </div>

        <!-- Main Rank Display -->
        <div class="p-6 flex flex-col items-center">
            <img id="rank-icon" src="https://placehold.co/200x200/0a1428/c8aa6e?text=..." alt="Rank Icon" class="w-48 h-48 mb-4">
            <h2 class="text-4xl font-bold brand-gold" id="rank-division"></h2>
            <p class="text-2xl text-white" id="league-points"></p>

            <!-- LP Progress Bar -->
            <div class="w-full bg-gray-700/50 rounded-full h-2.5 mt-4 overflow-hidden">
                <div id="lp-progress" class="bg-gradient-to-r from-sky-500 to-indigo-500 h-2.5 rounded-full"></div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="grid grid-cols-2 gap-4 p-6 border-t border-gray-700/50">
            <div class="text-center">
                <p class="text-gray-400 text-sm font-semibold">Winrate</p>
                <p class="text-2xl font-bold text-white" id="winrate"></p>
            </div>
            <div class="text-center">
                <p class="text-gray-400 text-sm font-semibold">Ranked Games</p>
                <p class="text-2xl font-bold text-white" id="total-games"></p>
                <p class="text-xs font-semibold">
                    <span class="brand-green" id="wins"></span>
                    <span class="text-gray-500"> / </span>
                    <span class="brand-red" id="losses"></span>
                </p>
            </div>
        </div>

        <!-- Road to Master Section -->
        <div class="p-6 bg-black/20" id="road-to-master">
           <h3 class="text-lg font-bold text-center brand-gold mb-4 uppercase tracking-widest">Road to Master</h3>
           <div class="space-y-3">
               <div class="flex justify-between items-center">
                 <p class="text-gray-300">LP Needed</p>
                 <p class="text-lg font-bold brand-gold" id="lp-to-master"></p>
               </div>
               <div class="flex justify-between items-center">
                 <p class="text-gray-300">Est. Wins</p>
                 <p class="text-lg font-bold brand-green" id="wins-to-master"></p>
               </div>
           </div>
           <p class="text-xs text-center text-gray-500 mt-4" id="avg-lp-gain"></p>
        </div>
    </div>

    <!-- Initial State / Loader -->
    <div id="initial-state" class="text-center text-white">
        <div class="loader mx-auto"></div>
        <p class="mt-4 text-lg font-semibold brand-blue">Fetching Summoner Data...</p>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- CONFIGURATION ---
    const SUMMONER_NAME = 'Vixen';
    const TAG_LINE = 'BWC';
    const SERVER = 'EUW';
    
    // --- DATA CONFIGURATION ---
    // UPDATED to use your local asset filenames in all lowercase
    const rankData = {
        IRON:        { icon: 'iron.png', divisions: 4, baseLp: 0 },
        BRONZE:      { icon: 'bronze.png', divisions: 4, baseLp: 400 },
        SILVER:      { icon: 'silver.png', divisions: 4, baseLp: 800 },
        GOLD:        { icon: 'gold.png', divisions: 4, baseLp: 1200 },
        PLATINUM:    { icon: 'platinum.png', divisions: 4, baseLp: 1600 },
        EMERALD:     { icon: 'emerald.png', divisions: 4, baseLp: 2000 },
        DIAMOND:     { icon: 'diamond.png', divisions: 4, baseLp: 2400 },
        MASTER:      { icon: 'master.png', divisions: 1, baseLp: 2800 },
        GRANDMASTER: { icon: 'grandmaster.png', divisions: 1, baseLp: 2800 },
        CHALLENGER:  { icon: 'challenger.png', divisions: 1, baseLp: 2800 },
    };
    const divisionMap = { 'I': 1, 'II': 2, 'III': 3, 'IV': 4 };

    /**
     * Processes raw account data to calculate derived stats.
     */
    function calculateStatus(data) {
        const totalGames = data.wins + data.losses;
        const winrate = totalGames > 0 ? ((data.wins / totalGames) * 100).toFixed(1) : 0;
        
        const rankKey = data.rank.toUpperCase();
        const currentRankInfo = rankData[rankKey];
        
        if (!currentRankInfo || currentRankInfo.divisions === 1) {
            return { ...data, totalGames, winrate, lpToMaster: 0, winsToMaster: 0, avgLpGain: 0 };
        }

        const divisionNumber = divisionMap[data.division.toUpperCase()];
        const lpWithinRank = (currentRankInfo.divisions - divisionNumber) * 100;
        const totalCurrentLp = currentRankInfo.baseLp + lpWithinRank + data.leaguePoints;

        const masterLpTarget = rankData['MASTER'].baseLp;
        const lpToMaster = Math.max(0, masterLpTarget - totalCurrentLp);

        const avgLpGain = data.recentLPGains.length > 0
            ? data.recentLPGains.reduce((a, b) => a + b, 0) / data.recentLPGains.length
            : 25; // Default average LP gain

        const winsToMaster = avgLpGain > 0 ? Math.ceil(lpToMaster / avgLpGain) : 'N/A';

        return { ...data, totalGames, winrate, lpToMaster, winsToMaster, avgLpGain: avgLpGain.toFixed(0) };
    }

    /**
     * Updates the HTML elements with the calculated status.
     */
    function updateUI(status) {
        // UPDATED to point to your local /assets/ folder
        const iconBaseUrl = '/assets/';
        
        const setText = (id, text) => { document.getElementById(id).textContent = text; };

        setText('summoner-name', `${status.summonerName} #${status.tagLine}`);
        setText('server', status.server);

        const rankKey = status.rank.toUpperCase();
        const rankInfo = rankData[rankKey];
        if (rankInfo) {
            document.getElementById('rank-icon').src = `${iconBaseUrl}${rankInfo.icon}`;
        }
        
        const formattedRank = status.rank.charAt(0) + status.rank.slice(1).toLowerCase();
        setText('rank-division', `${formattedRank} ${status.division}`);
        setText('league-points', `${status.leaguePoints} LP`);
        document.getElementById('lp-progress').style.width = `${status.leaguePoints}%`;

        setText('winrate', `${status.winrate}%`);
        setText('total-games', status.totalGames);
        setText('wins', `${status.wins}W`);
        setText('losses', `${status.losses}L`);

        const roadToMasterEl = document.getElementById('road-to-master');
        if (status.lpToMaster > 0 && rankKey !== 'MASTER' && rankKey !== 'GRANDMASTER' && rankKey !== 'CHALLENGER') {
            setText('lp-to-master', `${status.lpToMaster} LP`);
            const winText = status.winsToMaster === 1 ? 'Win' : 'Wins';
            setText('wins-to-master', `~${status.winsToMaster} ${winText}`);
            setText('avg-lp-gain', `Based on an average of +${status.avgLpGain} LP per win.`);
        } else {
            roadToMasterEl.innerHTML = `<h3 class="text-xl font-semibold text-center brand-green py-8">Congratulations on reaching Master!</h3>`;
        }

        // Show the card and hide the loader
        document.getElementById('initial-state').classList.add('hidden');
        document.getElementById('tracker-card').classList.remove('hidden');
    }
    
    /**
      * Fetches data from the backend and initializes the application.
      */
    async function initializeTracker() {
        try {
            const response = await fetch(`http://localhost:3000/api/rank/${SERVER}/${SUMMONER_NAME}/${TAG_LINE}`);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
            }
            const liveData = await response.json();
            const finalStatus = calculateStatus(liveData);
            updateUI(finalStatus);
        } catch (error) {
            console.error("Failed to fetch live data:", error);
            const initialStateDiv = document.getElementById('initial-state');
            initialStateDiv.innerHTML = `<p class="text-lg font-semibold brand-red">Error: ${error.message}</p><p class="text-gray-400 mt-2">Could not load summoner data. Please check the console and ensure the backend server is running.</p>`;
        }
    }

    // --- INITIALIZATION ---
    initializeTracker();
});
</script>

</body>
</html>

